<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>智能家居控制面板</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    
    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <!-- 背景容器 -->
    <div id="background-container"></div>

    <!-- 移动端顶部页眉容器 -->
    <div class="mobile-headerbar-container" id="mobile-headerbar">
        <!-- 页眉内容将动态加载 -->
    </div>

    <!-- 主内容区域 -->
    <div class="main-content" id="main-content">
        <!-- 页面内容将动态加载 -->
    </div>

    <!-- 底部导航栏 -->
    <nav class="bottom-nav">
        <div class="nav-item active" data-page="home">
            <div class="nav-icon">🏠</div>
            <div class="nav-text">首页</div>
        </div>
        <div class="nav-item" data-page="scenes">
            <div class="nav-icon">🎬</div>
            <div class="nav-text">场景</div>
        </div>
        <div class="nav-item" data-page="settings">
            <div class="nav-icon">⚙️</div>
            <div class="nav-text">设置</div>
        </div>
    </nav>

    <!-- 引入Vue -->
    <script src="libs/vue.global.js"></script>

    <!-- 引入配置文件 -->
    <script src="config/config.js"></script>
    <script src="config/device_config.js"></script>

    <!-- 引入HA连接、WebSocket、状态管理器和设备控制 -->
    <script src="app/ha-connection.js"></script>
    <script src="app/websocket-manager.js"></script>
    <script src="app/state-manager.js"></script>
    <script src="app/device-controller.js"></script>
    
    <!-- 注册 Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // 检查是否在支持的协议下运行（file:// 不支持 Service Worker）
                if (window.location.protocol === 'file:') {
                    console.log('[SW] 本地文件协议不支持 Service Worker，跳过注册');
                    return;
                }
                
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('[SW] 注册成功:', registration.scope);
                    })
                    .catch(error => {
                        console.log('[SW] 注册失败:', error);
                    });
            });
        }
    </script>

    <!-- 卡片组件由 config.js 的 cards 配置统一加载，无需在此逐个引入；加载完成后再加载 index.js -->
    <script src="app/cards-loader.js"></script>
</body>
</html>
